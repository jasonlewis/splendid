/**
 * Splendid v1.0.0 copyright 2012 Jason Lewis (3-clause BSD)
 */
(function(a){a.fn.splendid=function(b){var c=a.extend({},a.fn.splendid.defaults,b);return this.each(function(){var b={element:a(this),interactions:null,selection:{start:0,end:0,length:0},container:null,value:null};b.interactions=new a.fn.splendid.interactions(b.element);b.element.on("focusout",function(){b.selection=b.interactions.getSelection()});if(c.generate){b.container=a(c.container);b.element.before(b.container)}a.each(c.maps,function(d,e){var f={element:null,run:{}},g=this;if(c.generate){b.container.append(f.element=a(c.buttons).html(a("<a>")));if("text"in this){f.element.find("a").html(this.text)}}else{f.element=c.buttons.parent().find('[data-map="'+d+'"]')}if("class"in this){f.element.addClass(this.class)}f.element.on({click:function(a){a.preventDefault();f.run.after=b.interactions.checkReplacement(g.after);f.run.before=b.interactions.checkReplacement(g.before);f.run.replace=b.interactions.checkReplacement(g.replace);if(f.run.before===false||f.run.after===false||f.run.replace===false){return}b.value=b.element.val();if("replace"in g){b.value=[b.value.slice(0,b.selection.start),b.value.slice(b.selection.end),f.run.replace].join("")}if("after"in g){b.value=[b.value.slice(0,b.selection.end),f.run.after,b.value.slice(b.selection.end)].join("")}if("before"in g){b.value=[b.value.slice(0,b.selection.start),f.run.before,b.value.slice(b.selection.start)].join("")}b.element.focus();if(b.selection.length==0&&"placeholder"in g){b.value=[b.value.slice(0,b.selection.start+f.run.before.length),g.placeholder,b.value.slice(b.selection.start+f.run.before.length)].join("")}b.element.val(b.value);if(b.selection.length==0&&"placeholder"in g){b.interactions.setSelection(b.selection.start+f.run.before.length,b.selection.start+f.run.before.length+g.placeholder.length)}}})})})};a.fn.splendid.interactions=function(a){this.splendid=a};a.fn.splendid.interactions.prototype.getPosition=function(){console.log(this.splendid)};a.fn.splendid.interactions.prototype.getSelection=function(){var a={start:0,end:0,length:0,text:null};if(typeof this.splendid.get(0).selectionStart=="number"&&typeof this.splendid.get(0).selectionEnd=="number"){a.start=this.splendid.get(0).selectionStart;a.end=this.splendid.get(0).selectionEnd;a.length=a.end-a.start}else{var b={range:document.selection.createRange(),normalized:this.splendid.val().replace(/\r\n/g,"\n"),selection:this.splendid.get(0).createTextRange(),endRange:this.splendid.get(0).createTextRange()};b.selection.moveToBookmark(b.range.getBookmark());b.endRange.collapse(false);if(b.selection.compareEndPoints("StartToEnd",b.endRange)>-1){a.start=a.end=this.splendid.val().length;a.length=a.end-a.start}else{a.start=-b.selection.moveStart("character",-this.splendid.val().length);if(b.selection.compareEndPoints("EndToEnd",b.endRange)>-1){a.end=this.splendid.val().length}else{a.end=-b.selection.moveEnd("character",-this.splendid.val().length);a.end+=b.normalized.slice(0,a.end).split("\n").length-1}a.length=a.end-a.start}}a.text=this.splendid.val().slice(a.start,a.end);return a};a.fn.splendid.interactions.prototype.setSelection=function(a,b){if(typeof this.splendid.get(0).selectionStart=="number"&&typeof this.splendid.get(0).selectionEnd=="number"){this.splendid.get(0).selectionStart=a;this.splendid.get(0).selectionEnd=b}else{var c={range:this.splendid.get(0).createTextRange()};c.range.collapse(true);c.range.moveStart("character",a);c.range.moveEnd("character",b-a);c.range.select()}};a.fn.splendid.interactions.prototype.checkReplacement=function(a){if(typeof a==="function"){a=a()}var b={matches:null,details:null,response:null};while(b.matches=/\[\@(.*?)\]/g.exec(a)){if(b.details=/\[\@([^:\]]+):?(.*?)?\]/g.exec(b.matches[0])){if((b.response=prompt(b.details[1],typeof b.details[2]!="undefined"?b.details[2]:""))!==false){a=a.replace(b.details[0],b.response)}else{return false}}}return a};a.fn.splendid.defaults={container:'<ul class="splendid-container">',buttons:'<li class="splendid-button">',maps:{},generate:false}})(jQuery)